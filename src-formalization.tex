%TODO remove parentheses around parameter lists: $\otimes$ and $\mathcal{D}$
%TODO add abstract machine semantics

In the formalization of the language we use an orientation parameter $\pol \in \{ \polprd,\polcon \}$ and functions

\begin{align*}
  \boxed{\polprd}
  :=\ >
  \quad
  \boxed{\polcon}
  :=\ <
  \qquad
  \widehat{\polprd}
  :=\ \polcon
  \quad
  \widehat{\polcon}
  :=\ \polprd
\end{align*}

\subsection{Syntax}

The syntax is defined in \cref{fig:?:syntax}.

\begin{figure}[H]
    \setlength{\abovedisplayskip}{0pt}
    \setlength{\belowdisplayskip}{0pt}
    \setlength{\abovedisplayshortskip}{0pt}
    \setlength{\belowdisplayshortskip}{0pt}
  \[
  \begin{array}{lclr}
    \multicolumn{4}{r}{
      i \in \mathbb{N}
      \quad
      \mathcal{M} \in \mu\textsc{Abs}
      \quad
      \mathcal{C} \in \textsc{Ctor}
      \quad
      \mathcal{D} \in \textsc{Dtor}
      \quad
      \mathcal{T} \in \textsc{Type}
      \mspace{60mu}
      \emph{Names}
    }
    \\
    \multicolumn{4}{r}{
      a \in \textsc{Contants}
      \mspace{60mu}
      \emph{Values}
    }
    \\[0.5cm]

    % Types
    T
    & \Coloneqq
    & \Bool\ |\ \Int\ |\ \mathcal{T}
    & \emph{Types}
    \\[0.5cm]

    % o-Signature
    \Sigma^{\pol}
    & \Coloneqq
    & \varnothing\ |\ \prdcon T
    & \emph{$\pol$-Signature}
    \\[0.5cm]

    % prd-Terms
    t^{\polprd}
    & \Coloneqq
    & \otimes\big(\overline{t^{\polprd}}\big)
    & \emph{Primitive-Operator-Application}
    \\
    & | & \mathcal{C}
    & \emph{Constructor}
    \\
    & | & \mathcal{C}\text{-}\mathcal{D}^{i}
    & \emph{$\polprd$-Parameter}
    \\
    & | & \mathcal{M}^{i}
    & \emph{$\mu$-Parameter}
    \\[0.5cm]

    % con-Terms
    t^{\polcon}
    & \Coloneqq
    & \mathcal{C}\text{-}\mathcal{D}_{i}
    & \emph{$\polcon$-Parameter}
    \\
    & | & \mathcal{D}\big(\overline{t^{\polprd}}\big)\big(\overline{t^{\polcon}}\big)
    & \emph{Destructor-Application}
    \\
    & | & \mathcal{M}
    & \emph{$\mu$-Abstraction}
    \\[0.5cm]

    % Commands
    c
    & \Coloneqq
    & t^{\polprd} \mkCmd t^{\polcon}
    & \emph{Command}
    \\[0.5cm]

    % Constructor-Definition
    C
    & \Coloneqq
    & \textsc{Ctor} \to \codata\
      \mathcal{T}\
      \where\
      \overline{\mathcal{D}\Sigma^{\polprd}\Sigma^{\polcon}}\
      := \match\
         \overline{c}
    & \emph{Constructor-Definitions}
    \\[0.5cm]

    % mu-Definition
    M
    & \Coloneqq
    & \mu\textsc{Abs} \to T\ \inin\ c
    & \emph{$\mu$-Definitions}
    \\[0.5cm]

    % Program
    P
    & \Coloneqq
    & 
      C
      \ \&\
      M
    & \emph{Program}
    \\[0.5cm]

    % prd-Values
    v^{\polprd}
    & \Coloneqq
    & a
    & \emph{Literal}
    \\
    & | & \langle \mathcal{C}, \sigma \rangle
    & \emph{Object}
    \\[0.5cm]

    % con-Values
    v^{\polcon}
    & \Coloneqq
    & \Done
    & \emph{Top-Level-Consumer}
    \\
    & | & \mathcal{D}\big(\overline{v^{\polprd}}\big)\big(\overline{v^{\polcon}}\big)
    & \emph{Observation}
    \\
    & | & \langle \mathcal{M}, \sigma \rangle
    & \emph{Continuation}
    \\[0.5cm]
  \end{array}
  \]
  \caption{Syntax.}
  \label{fig:?:syntax}
\end{figure}

\subsection{Semantic}
Define environments $\sigma$ as records
\begin{align*}
  \left\lbrace
    C:
      \textsc{Ctor}
      \to
      \text{List}
      \left(
        \left(
          V^{\polprd} \times \ldots \times V^{\polprd}
        \right),
        \left(
          V^{\polcon} \times \ldots \times V^{\polcon}
        \right)
      \right);
    M: \mu\textsc{Abs} \to V^{\polprd}
  \right\rbrace
  \\
\end{align*}

\begin{prooftree}
  \AxiomC{$
    P.C[\mathcal{C}].\mathcal{D}
    =
    t^{\polprd} \mkCmd t^{\polcon}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polprd}}{\langle \mathcal{C}^{\prime}, \sigma^{\prime} \rangle}
  $}
  \AxiomC{$
    \semtm
      {\sigma}
      {t^{\polcon}}
      {\mathcal{D}\big(\overline{v^{\polprd}}\big)\big(\overline{v^{\polcon}}\big)}
  $}
  \RightLabel{\textsc{E-Cmd-Ctor}}
  \TrinaryInfC{$
    \semcmd
      {P}
      {\sigma}
      {\mathcal{C}}
      {
        \sigma^{\prime}
        \left[
          \overline{\mathcal{C}\mathcal{D}^{i} \mapsto v_{i}^{\polprd}},
          \overline{\mathcal{C}\mathcal{D}_{i} \mapsto v_{i}^{\polcon}}
        \right]
      }
      {\mathcal{C}^{\prime}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.M[\mathcal{M}]
    =
    \ldots
    t^{\polprd} \mkCmd t^{\polcon}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polprd}}{v^{\polprd}}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polcon}}{\langle \mathcal{M}^{\prime}, \sigma^{\prime} \rangle}
  $}
  \RightLabel{\textsc{E-Cmd-$\mu$Abs}}
  \TrinaryInfC{$
    \semcmd
      {P}
      {\sigma}
      {\mathcal{M}}
      {\sigma^{\prime}[\mathcal{M}^{i} \mapsto v^{\polprd}]}
      {\mathcal{M}^{\prime}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.C[\mathcal{C}].\mathcal{D}
    =
    t^{\polprd} \mkCmd t^{\polcon}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polprd}}{v^{\polprd}}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polcon}}{\langle \mathcal{M}^{\prime}, \sigma^{\prime} \rangle}
  $}
  \RightLabel{\textsc{E-Cmd-Ctor-$\mu$Abs}}
  \TrinaryInfC{$
    \semcmd
      {P}
      {\sigma}
      {\mathcal{C}}
      {\sigma^{\prime}[\mathcal{M}^{i} \mapsto v^{\polprd}]}
      {\mathcal{M}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.M[\mathcal{M}]
    =
    \ldots
    t^{\polprd} \mkCmd t^{\polcon}
  $}
  \AxiomC{$
    \semtm{\sigma}{t^{\polprd}}{\langle \mathcal{C}, \sigma^{\prime} \rangle}
  $}
  \AxiomC{$
    \semtm
      {\sigma}
      {t^{\polcon}}
      {\mathcal{D}\big(\overline{v^{\polprd}}\big)\big(\overline{v^{\polcon}}\big)}
  $}
  \RightLabel{\textsc{E-Cmd-$\mu$Abs-Ctor}}
  \TrinaryInfC{$
    \semcmd
      {P}
      {\sigma}
      {\mathcal{M}}
      {
        \sigma^{\prime}
        \left[
          \overline{\mathcal{C}\mathcal{D}^{i} \mapsto v_{i}^{\polprd}},
          \overline{\mathcal{C}\mathcal{D}_{i} \mapsto v_{i}^{\polcon}}
        \right]
      }
      {\mathcal{C}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \overline{\semtm{\sigma}{t^{\polprd}}{v^{\polprd}}}
  $}
  \RightLabel{\textsc{E-PrimOpApp}}
  \UnaryInfC{$
    \semtm
      {\sigma}
      {\otimes\big(\overline{t^{\polprd}}\big)}
      {\tilde{\otimes}\big(\overline{v^{\polprd}}\big)}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \text{lookup}(\sigma.C[\mathcal{C}], \mathcal{D})
    =
    \left(
      \left(
        \ldots,
        v_{i}^{\polprd},
        \ldots
      \right),
      \left(
        \ldots
      \right)
    \right)
  $}
  \RightLabel{\textsc{E-$\polprd$-Param}}
  \UnaryInfC{$
    \semtm{\sigma}{\mathcal{C}\text{-}\mathcal{D}^{i}}{v_{i}^{\polprd}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{}
  \RightLabel{\textsc{E-Ctor}}
  \UnaryInfC{$
    \semtm
      {\sigma}
      {\mathcal{C}}
      {\langle \mathcal{C}, \sigma \rangle}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \sigma.M[\mathcal{M}]
    =
    v^{\polprd}
  $}
  \RightLabel{\textsc{E-$\mu$-Param}}
  \UnaryInfC{$
    \semtm{\sigma}{\mathcal{M}_{i}}{v^{\polprd}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \text{lookup}(\sigma.C[\mathcal{C}], \mathcal{D})
    =
    \left(
      \left(
        \ldots
      \right),
      \left(
        \ldots,
        v_{i}^{\polcon},
        \ldots
      \right)
    \right)
  $}
  \RightLabel{\textsc{E-$\polcon$-Param}}
  \UnaryInfC{$
    \semtm{\sigma}{\mathcal{C}\text{-}\mathcal{D}_{i}}{v_{i}^{\polprd}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \overline{\semtm{\sigma}{t^{\polprd}}{v^{\polprd}}}
  $}
  \AxiomC{$
    \overline{\semtm{\sigma}{t^{\polcon}}{v^{\polcon}}}
  $}
  \RightLabel{\textsc{E-DtorApp}}
  \BinaryInfC{$
    \semtm
      {\sigma}
      {\mathcal{D}\big(\overline{t^{\polprd}}\big)\big(\overline{t^{\polcon}}\big)}
      {\mathcal{D}\big(\overline{v^{\polprd}}\big)\big(\overline{v^{\polcon}}\big)}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{}
  \RightLabel{\textsc{E-$\mu$Abs}}
  \UnaryInfC{$
    \semtm
      {\sigma}
      {\mathcal{M}}
      {\langle \mathcal{M}, \sigma \rangle}
  $}
\end{prooftree}
\vspace*{0.3cm}

\subsection{Typing}

\begin{prooftree}
  \AxiomC{$
    T
    =
    \text{check}_{\otimes}\big(\overline{t^{\polprd}}\big)
  $}
  \RightLabel{\textsc{Tm-PrimOpApp}}
  \UnaryInfC{$
    \typetmprd{P}{\otimes\big(\overline{t^{\polprd}}\big)}{T}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.C[\mathcal{C}]
    =
    \codata\ \mathcal{T} \ldots
  $}
  \RightLabel{\textsc{Tm-Ctor}}
  \UnaryInfC{$
    \typetmprd{P}{\mathcal{C}}{\mathcal{T}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.C[\mathcal{C}]
    =
    \ldots \where \ldots \mathcal{D}\Sigma^{\polprd}\Sigma^{\polcon} \ldots
  $}
  \AxiomC{$
    T
    =
    \Sigma^{\polprd}(i)
  $}
  \RightLabel{\textsc{Tm-$\polprd$-Param}}
  \BinaryInfC{$
    \typetmprd{P}{\mathcal{C}\text{-}\mathcal{D}^{i}}{T}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.M[\mathcal{M}]
    =
    T\ \inin\ \ldots
  $}
  \RightLabel{\textsc{Tm-$\mu$-Param}}
  \UnaryInfC{$
    \typetmprd{P}{\mathcal{M}^{i}}{T}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.C[\mathcal{C}]
    =
    \ldots \where \ldots \mathcal{D}\Sigma^{\polprd}\Sigma^{\polcon} \ldots
  $}
  \AxiomC{$
    T
    =
    \Sigma^{\polcon}(i)
  $}
  \RightLabel{\textsc{Tm-$\polcon$-Param}}
  \BinaryInfC{$
    \typetmcon{P}{\mathcal{C}\text{-}\mathcal{D}_{i}}{T}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    (\Sigma^{\polprd}, \Sigma^{\polcon})
    =
    \text{Sig}(\mathcal{D}, \mathcal{T}, P)
  $}
  \AxiomC{$
    \forall i,\, \typetmprd{P}{t_{i}^{\polprd}}{\Sigma^{\polprd}(i)}
  $}
  \AxiomC{$
    \forall i,\, \typetmcon{P}{t_{i}^{\polcon}}{\Sigma^{\polcon}(i)}
  $}
  \RightLabel{\textsc{Tm-DtorApp}}
  \TrinaryInfC{$
    \typetmcon
      {P}
      {\mathcal{D}\big(\overline{t^{\polprd}}\big)\big(\overline{t^{\polcon}}\big)}
      {\mathcal{T}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    P.M[\mathcal{M}]
    =
    T\ \inin\ \ldots
  $}
  \RightLabel{\textsc{Tm-$\mu$Abs}}
  \UnaryInfC{$
    \typetmcon{P}{\mathcal{M}}{T}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$
    \typetmprd{P}{t^{\polprd}}{T}
  $}
  \AxiomC{$
    \typetmcon{P}{t^{\polcon}}{T}
  $}
  \RightLabel{\textsc{Cmd-Cut}}
  \BinaryInfC{$
    \typecmd{P}{t^{\polprd} \mkCmd t^{\polcon}}
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\forall \mathcal{C},\, \overline{\typecmd{P}{c}}$}
  \RightLabel{\textsc{Wf-Ctor}}
  \UnaryInfC{$
    \typewf{
      \textsc{Ctor}
      \to
      \codata\
      \mathcal{T}\
      \where\
      \overline{\mathcal{D}\Sigma^{\polprd}\Sigma^{\polcon}}\
      := \match\
         \overline{c}
    }
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\typecmd{P}{c}$}
  \RightLabel{\textsc{Wf-$\mu$}}
  \UnaryInfC{$
    \typewf{
      \mu\textsc{Abs}
      \to
      T\ \inin\ c
    }
  $}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\typewf{C}$}
  \AxiomC{$\typewf{M}$}
  \RightLabel{\textsc{Wf-Program}}
  \BinaryInfC{$\typewf{C\ \&\ M}$}
\end{prooftree}
\vspace*{0.3cm}

\subsection{Liveness}
Let $\mathcal{L} \in \mu\textsc{Abs} \cup \textsc{Ctor}$ and define $\textsc{Scope}_{P}(\mathcal{L}_{e}) := \lbrace \mathcal{L} \,|\, \liveness{P}{\mathcal{L}_{e}}{\mathcal{L}} \rbrace$ where
\\
\begin{prooftree}
  \AxiomC{$\mathcal{C} \neq \mathcal{C}^{\prime}$}
  \AxiomC{$P.C[\mathcal{C}^{\prime}] = \ldots \overline{c_{\mathcal{C}^{\prime}}}$}
  \AxiomC{$
    \exists
    \mathcal{D}^{i},\,
    \mathcal{C}\text{-}\mathcal{D}^{i} \leq c_{\mathcal{C}^{\prime}}
    \,
    \lor
    \,
    \ldots
  $}
  \RightLabel{\textsc{Live-$\polprd$-Param}}
  \TrinaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{C}^{\prime}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\mathcal{C} \neq \mathcal{C}^{\prime}$}
  \AxiomC{$P.C[\mathcal{C}^{\prime}] = \ldots \overline{c_{\mathcal{C}^{\prime}}}$}
  \AxiomC{$
    \exists
    \mathcal{D}_{i},\,
    \mathcal{C}\text{-}\mathcal{D}_{i} \leq c_{\mathcal{C}^{\prime}}
    \,
    \lor
    \,
    \ldots
  $}
  \RightLabel{\textsc{Live-$\polcon$-Param}}
  \TrinaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{C}^{\prime}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\mathcal{U} \neq \mathcal{U}^{\prime}$}
  \AxiomC{$P.M[\mathcal{U}^{\prime}] = \ldots c_{\mathcal{U}^{\prime}}$}
  \AxiomC{$
    \exists
    i,\,
    \mathcal{U}^{i} \leq c_{\mathcal{U}^{\prime}}
  $}
  \RightLabel{\textsc{Live-$\mu$-Param}}
  \TrinaryInfC{$\liveness{P}{\mathcal{U}}{\mathcal{U^{\prime}}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$P.C[\mathcal{C}] = \ldots \overline{c_{\mathcal{C}}}$}
  \AxiomC{$
    \exists
    i,\,
    \mathcal{U}^{i} \leq c_{\mathcal{C}}
    \,
    \lor
    \,
    \ldots
  $}
  \RightLabel{\textsc{Live-$\mu$-Param-Ctor}}
  \BinaryInfC{$\liveness{P}{\mathcal{U}}{\mathcal{C}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$P.M[\mathcal{U}] = \ldots c_{\mathcal{U}}$}
  \AxiomC{$
    \exists
    \mathcal{D}^{i},\,
    \mathcal{C}\text{-}\mathcal{D}^{i} \leq c_{\mathcal{U}}
  $}
  \RightLabel{\textsc{Live-$\polprd$-Param-$\mu$Abs}}
  \BinaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{U}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$P.M[\mathcal{U}] = \ldots c_{\mathcal{U}}$}
  \AxiomC{$
    \exists
    \mathcal{D}_{i},\,
    \mathcal{C}\text{-}\mathcal{D}_{i} \leq c_{\mathcal{U}}
  $}
  \RightLabel{\textsc{Live-$\polcon$-Param-$\mu$Abs}}
  \BinaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{U}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\mathcal{C} \neq \mathcal{C}^{\prime}$}
  \AxiomC{$\liveness{P}{\mathcal{C}}{\mathcal{L}}$}
  \AxiomC{$P.C[\mathcal{C}^{\prime}] = \ldots \overline{c_{\mathcal{C}^{\prime}}}$}
  \AxiomC{$
    \mathcal{L} \leq c_{\mathcal{C}^{\prime}}
    \,
    \lor
    \,
    \ldots
  $}
  \RightLabel{\textsc{Live-Ctor}}
  \QuaternaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{C}^{\prime}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\mathcal{U} \neq \mathcal{U}^{\prime}$}
  \AxiomC{$\liveness{P}{\mathcal{U}}{\mathcal{L}}$}
  \AxiomC{$P.M[\mathcal{U}^{\prime}] = \ldots c_{\mathcal{U}^{\prime}}$}
  \AxiomC{$
    \mathcal{L} \leq c_{\mathcal{U}^{\prime}}
  $}
  \RightLabel{\textsc{Live-$\mu$Abs}}
  \QuaternaryInfC{$\liveness{P}{\mathcal{U}}{\mathcal{U}^{\prime}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\liveness{P}{\mathcal{U}}{\mathcal{L}}$}
  \AxiomC{$P.C[\mathcal{C}] = \ldots \overline{c_{\mathcal{C}}}$}
  \AxiomC{$
    \mathcal{L} \leq c_{\mathcal{C}}
    \,
    \lor
    \,
    \ldots
  $}
  \RightLabel{\textsc{Live-$\mu$Abs-Ctor}}
  \TrinaryInfC{$\liveness{P}{\mathcal{U}}{\mathcal{C}}$}
\end{prooftree}
\vspace*{0.3cm}

\begin{prooftree}
  \AxiomC{$\liveness{P}{\mathcal{C}}{\mathcal{L}}$}
  \AxiomC{$P.M[\mathcal{U}] = \ldots c_{\mathcal{U}}$}
  \AxiomC{$
    \mathcal{L} \leq c_{\mathcal{U}}
  $}
  \RightLabel{\textsc{Live-Ctor-$\mu$Abs}}
  \TrinaryInfC{$\liveness{P}{\mathcal{C}}{\mathcal{U}}$}
\end{prooftree}
\vspace*{0.3cm}

%\subsection{Operational Semantics}
%\[
%  \begin{array}{lclr} 
%    % o-Values
%    v^{\pol}
%    & \Coloneqq
%    & \mathcal{C}^{\pol}\overline{v^{\pol}}
%      \ |\
%      \mathcal{D}^{\pol}\overline{v^{\pol}}\, \overline{h}
%    & \emph{$\pol$-Values}
%    \\[0.5cm]
%
%    % o-Contexts
%    ctx^{\pol}
%    & \Coloneqq
%    & \square
%    \\
%    & | & \mathcal{C}^{\pol}
%          (\overline{v^{\pol}},ctx^{\pol},\overline{t^{\pol}})
%    \\
%    & | & \mathcal{D}^{\pol}
%          (\overline{v^{\pol}},ctx^{\pol},\overline{t^{\pol}})\,
%          \overline{h}
%    \\
%    & | & ctx^{\pol}\ \boxed{\pol}\ \mathcal{F}^{\pol}\sigma^{\pol}
%    \\
%    & | & v^{\pol}\
%          \boxed{\pol}\
%          \mathcal{F}^{\pol}
%          \big( (\overline{v^{\pol}},ctx^{\pol},\overline{t^{\pol}}),\overline{b^{\pol}} \big)
%    \\
%    & | & b^{\pol}
%          \big( (\overline{v^{\pol}},ctx^{\pol},\overline{t^{\pol}}),\overline{b^{\pol}} \big)
%    & \emph{$\pol$-Contexts}
%    \\[0.5cm]
%
%    % o-Blocks
%    b^{\pol}
%    & \Coloneqq
%    & \ldots\ |\ \capab\{ (x^{\pol}, k^{\pol}) \Rightarrow t^{\pol} \}
%    & \emph{$\pol$-Blocks}
%    \\[0.5cm]
%
%    % Commands
%    c
%    & \Coloneqq
%    & \ldots\ |\ t^{\polprd} \mkCmd_{T} t^{\polcon}
%    & \emph{Commands}
%    \\[0.5cm]
%  \end{array}
%\]
%
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%  \scriptsize
%    \AxiomC{$
%      \mathcal{C}^{\pol}\Gamma^{\pol} \Rightarrow t^{\pol}
%      \in
%      \textsc{Cases}(\mathcal{F}^{\pol})
%    $}
%    \RightLabel{\textsc{R-$\pol$-Match1}}
%    \UnaryInfC{$
%      \mathcal{C}^{\pol}\overline{v^{\pol}}'\
%      \boxed{\pol}\
%      \mathcal{F}^{\pol}(\overline{v^{\pol}}, \overline{b^{\pol}})
%      \reducesto_{\pol}
%      t^{\pol}[\overline{v^{\pol}}'][\overline{v^{\pol}}][\overline{b^{\pol}}]
%    $}
%  \end{prooftree}
%\end{minipage}
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%  \scriptsize
%    \AxiomC{}
%    \RightLabel{\textsc{R-$\pol$-App}}
%    \UnaryInfC{$
%      \left(
%        (\overline{x^{\pol}}, \overline{k^{\pol}}) \Rightarrow t^{\pol}
%      \right)
%      (\overline{v^{\pol}}, \overline{b^{\pol}})
%      \reducesto_{\pol}
%      t^{\pol}[\overline{v^{\pol}}][\overline{b^{\pol}}]
%    $}
%  \end{prooftree}
%\end{minipage}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%  \AxiomC{$s^{\pol} \reducesto_{\pol} t^{\pol}$}
%  \RightLabel{\textsc{R-$\pol$}}
%  \UnaryInfC{$
%    ctx^{\pol}[s^{\pol}]
%    \reducesto_{\pol}
%    ctx^{\pol}[t^{\pol}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{$
%    \mathcal{C}_{i}^{\polcon}\Gamma_{i}^{\polcon}
%    \Rightarrow
%    \big( k^{\polprd} \Rightarrow t^{\polprd} \big) \mkCmd_{\mathcal{T}^{\polprd}} t^{\polcon}
%    \in
%    \textsc{Cases}(\mathcal{D}^{\polprd})
%  $}
%  \RightLabel{\textsc{R-$\polprd$-$\polprd$-Match2}}
%  \UnaryInfC{$
%    \left(
%      \mathcal{D}^{\polprd}
%      \overline{v^{\polprd}}
%      \ldots, (x_{i}^{\polprd},k_{i}^{\polprd}) \Rightarrow t_{i}^{\polprd}, \ldots
%      \mkCmd_{\mathcal{T}^{\polcon}}
%      \mathcal{C}_{i}^{\polcon}\overline{v^{\polcon}}
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}
%      \left[
%        \capab\{ (x_{i}^{\polprd},k_{i}^{\polprd}) \Rightarrow t_{i}^{\polprd} \} / k^{\polprd}
%      \right]
%      \mkCmd_{\mathcal{T}_{1}^{\polprd}}
%      t^{\polcon}
%    \right)
%    [\overline{v^{\polprd}}]
%    [\overline{v^{\polcon}}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{$
%    \mathcal{C}_{i}^{\polprd}\Gamma_{i}^{\polprd}
%    \Rightarrow
%    \big( k^{\polprd} \Rightarrow t^{\polprd} \big) \mkCmd_{\mathcal{T}_{1}^{\polprd}} t^{\polcon}
%    \in
%    \textsc{Cases}(\mathcal{D}^{\polcon})
%  $}
%  \RightLabel{\textsc{R-$\polprd$-$\polcon$-Match2}}
%  \UnaryInfC{$
%    \left(
%      \mathcal{C}_{i}^{\polprd}\overline{v^{\polprd}}
%      \mkCmd_{\mathcal{T}_{2}^{\polprd}}
%      \mathcal{D}^{\polcon}
%      \overline{v^{\polcon}}
%      \ldots, (x_{i}^{\polprd},k_{i}^{\polprd}) \Rightarrow t_{i}^{\polprd}, \ldots
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}
%      \left[
%        \capab\{ (x_{i}^{\polprd},k_{i}^{\polprd}) \Rightarrow t_{i}^{\polprd} \} / k^{\polprd}
%      \right]
%      \mkCmd_{\mathcal{T}_{1}^{\polprd}}
%      t^{\polcon}
%    \right)
%    [\overline{v^{\polprd}}]
%    [\overline{v^{\polcon}}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{$
%    \mathcal{C}_{i}^{\polcon}\Gamma_{i}^{\polcon}
%    \Rightarrow
%    t^{\polprd} \mkCmd_{\mathcal{T}_{1}^{\polcon}} \big( k^{\polcon} \Rightarrow t^{\polcon} \big)
%    \in
%    \textsc{Cases}(\mathcal{D}^{\polprd})
%  $}
%  \RightLabel{\textsc{R-$\polcon$-$\polprd$-Match2}}
%  \UnaryInfC{$
%    \left(
%      \mathcal{D}^{\polprd}
%      \overline{v^{\polprd}}
%      \ldots, (x_{i}^{\polcon},k_{i}^{\polcon}) \Rightarrow t_{i}^{\polcon}, \ldots
%      \mkCmd_{\mathcal{T}_{2}^{\polcon}}
%      \mathcal{C}_{i}^{\polcon}\overline{v^{\polcon}}
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}
%      \mkCmd_{\mathcal{T}_{1}^{\polprd}}
%      t^{\polcon}
%      \left[
%        \capab\{ (x_{i}^{\polcon},k_{i}^{\polcon}) \Rightarrow t_{i}^{\polcon} \} / k^{\polcon}
%      \right]
%    \right)
%    [\overline{v^{\polprd}}]
%    [\overline{v^{\polcon}}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{$
%    \mathcal{C}_{i}^{\polprd}\Gamma_{i}^{\polprd}
%    \Rightarrow
%    t^{\polprd} \mkCmd_{\mathcal{T}^{\polcon}} \big( k^{\polcon} \Rightarrow t^{\polcon} \big)
%    \in
%    \textsc{Cases}(\mathcal{D}^{\polcon})
%  $}
%  \RightLabel{\textsc{R-$\polcon$-$\polcon$-Match2}}
%  \UnaryInfC{$
%    \left(
%      \mathcal{C}_{i}^{\polprd}\overline{v^{\polprd}}
%      \mkCmd_{\mathcal{T}^{\polprd}}
%      \mathcal{D}^{\polcon}
%      \overline{v^{\polcon}}
%      \ldots, (x_{i}^{\polcon},k_{i}^{\polcon}) \Rightarrow t_{i}^{\polcon}, \ldots
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}
%      \mkCmd_{\mathcal{T}_{1}^{\polprd}}
%      t^{\polcon}
%      \left[
%        \capab\{ (x_{i}^{\polcon},k_{i}^{\polcon}) \Rightarrow t_{i}^{\polcon} \} / k^{\polcon}
%      \right]
%    \right)
%    [\overline{v^{\polprd}}]
%    [\overline{v^{\polcon}}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{minipage}{0.4\textwidth}
%  \begin{prooftree}
%  \scriptsize
%    \AxiomC{$
%      \mathcal{C}_{i}^{\polcon}\Gamma_{i}^{\polcon}
%      \Rightarrow
%      \Done
%      \in
%      \textsc{Cases}(\mathcal{D}^{\polprd})
%    $}
%    \RightLabel{\textsc{R-$\polprd$-Done}}
%    \UnaryInfC{$
%      \left(
%        \mathcal{D}^{\polprd}
%        \overline{v^{\polprd}}
%        \overline{h}
%        \mkCmd_{\mathcal{T}^{\polcon}}
%        \mathcal{C}_{i}^{\polcon}\overline{v^{\polcon}} 
%      \right)
%      \reducesto_{\cmd}
%      \Done
%    $}
%  \end{prooftree}
%\end{minipage}
%\begin{minipage}{0.4\textwidth}
%  \begin{prooftree}
%  \scriptsize
%    \AxiomC{$
%      \mathcal{C}_{i}^{\polprd}\Gamma_{i}^{\polprd}
%      \Rightarrow
%      \Done
%      \in
%      \textsc{Cases}(\mathcal{D}^{\polcon})
%    $}
%    \RightLabel{\textsc{R-$\polcon$-Done}}
%    \UnaryInfC{$
%      \left(
%        \mathcal{C}_{i}^{\polprd}\overline{v^{\polprd}}
%        \mkCmd_{\mathcal{T}^{\polprd}}
%        \mathcal{D}^{\polcon}
%        \overline{v^{\polcon}}
%        \overline{h}
%      \right)
%      \reducesto_{\cmd}
%      \Done
%    $}
%  \end{prooftree}
%\end{minipage}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{}
%  \RightLabel{\textsc{R-$\polprd$-Cap}}
%  \UnaryInfC{$
%    \left(
%      ctx^{\polprd}
%      \left[
%          \capab\{ (x^{\polprd}, k^{\polprd}) \Rightarrow t^{\polprd} \}(v^{\polprd})
%      \right]
%      \mkCmd_{\mathcal{T}^{\polprd}}
%      t^{\polcon}
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}[v^{\polprd} / x^{\polprd}][(x \Rightarrow ctx^{\polprd}[x]) / k^{\polprd}]
%      \mkCmd_{\mathcal{T}^{\polprd}}
%      t^{\polcon}
%    \right)
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%\scriptsize
%  \AxiomC{}
%  \RightLabel{\textsc{R-$\polcon$-Cap}}
%  \UnaryInfC{$
%    \left(
%      t^{\polprd}
%      \mkCmd_{\mathcal{T}^{\polcon}}
%      ctx^{\polcon}
%      \left[
%          \capab\{ (x^{\polcon}, k^{\polcon}) \Rightarrow t^{\polcon} \}(v^{\polcon})
%      \right]
%    \right)
%    \reducesto_{\cmd}
%    \left(
%      t^{\polprd}
%      \mkCmd_{\mathcal{T}^{\polcon}}
%      t^{\polcon}[v^{\polcon} / x^{\polcon}][(x \Rightarrow ctx^{\polcon}[x]) / k^{\polcon}]
%    \right)
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$s^{\polprd} \reducesto_{\polprd} t^{\polprd}$}
%    \RightLabel{\textsc{R-$\polprd$-$\polprd$}}
%    \UnaryInfC{$
%      (s^{\polprd} \mkCmd_{\mathcal{T}^{\polprd}} t^{\polcon})
%      \reducesto_{\cmd}
%      (t^{\polprd} \mkCmd_{\mathcal{T}^{\polprd}} t^{\polcon})
%    $}
%  \end{prooftree}
%\end{minipage}
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$s^{\polcon} \reducesto_{\polcon} t^{\polcon}$}
%    \RightLabel{\textsc{R-$\polprd$-$\polcon$}}
%    \UnaryInfC{$
%      (v^{\polprd} \mkCmd_{\mathcal{T}^{\polprd}} s^{\polcon})
%      \reducesto_{\cmd}
%      (v^{\polprd} \mkCmd_{\mathcal{T}^{\polprd}} t^{\polcon})
%    $}
%  \end{prooftree}
%\end{minipage}
%
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$s^{\polprd} \reducesto_{\polprd} t^{\polprd}$}
%    \RightLabel{\textsc{R-$\polcon$-$\polprd$}}
%    \UnaryInfC{$
%      (s^{\polprd} \mkCmd_{\mathcal{T}^{\polcon}} v^{\polcon})
%      \reducesto_{\cmd}
%      (t^{\polprd} \mkCmd_{\mathcal{T}^{\polcon}} v^{\polcon})
%    $}
%  \end{prooftree}
%\end{minipage}
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$s^{\polcon} \reducesto_{\polcon} t^{\polcon}$}
%    \RightLabel{\textsc{R-$\polcon$-$\polcon$}}
%    \UnaryInfC{$
%      (t^{\polprd} \mkCmd_{\mathcal{T}^{\polcon}} s^{\polcon})
%      \reducesto_{\cmd}
%      (t^{\polprd} \mkCmd_{\mathcal{T}^{\polcon}} t^{\polcon})
%    $}
%  \end{prooftree}
%\end{minipage}

%\subsection{Adding $\mu$-Abstractions?}
%
%\begin{figure}[H]
%    \setlength{\abovedisplayskip}{0pt}
%    \setlength{\belowdisplayskip}{0pt}
%    \setlength{\abovedisplayshortskip}{0pt}
%    \setlength{\belowdisplayshortskip}{0pt}
%  \[
%    \begin{array}{lclr}
%      % o-Terms
%      s^{\pol},t^{\pol}
%      & \Coloneqq
%      & \ldots
%      & \emph{}
%      \\
%      & | & \muqabsinv{x}{\mathcal{T}^{\flip{\pol}}}{c}
%      & \emph{$\mu$-$\flip{\pol}$-abstraction}
%      \\[0.5cm]
%  
%      % o-values
%      v^{\pol}
%      & \Coloneqq
%      & \ldots
%      & \emph{}
%      \\
%      & | & \muqabsinv{x}{\mathcal{T}^{\flip{\pol}}}{c}
%      & \emph{$\pol$-Values}
%      \\[0.5cm]
%    \end{array}
%  \]
%  \caption{Syntax.}
%  \label{fig:?:syntax}
%\end{figure}
%
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$
%      \Gamma^{\polprd}
%      \vdash
%      c
%      \dashv
%      x^{\polcon} \con \mathcal{T}^{\polcon}
%    $}
%    \RightLabel{\textsc{$\polprd$-$\mu$}}
%    \UnaryInfC{$
%      \Gamma^{\polprd}
%      \vdash
%      \muprdabs{x^{\polcon}}{\mathcal{T}^{\polcon}}{c}
%      \prd
%      \mathcal{T}^{\polcon}
%    $}
%  \end{prooftree}
%\end{minipage}
%\begin{minipage}{0.45\textwidth}
%  \begin{prooftree}
%    \AxiomC{$
%      x^{\polprd} \prd \mathcal{T}^{\polprd}
%      \vdash
%      c
%      \dashv
%      \Gamma^{\polcon}
%    $}
%    \RightLabel{\textsc{$\polcon$-$\mu$}}
%    \UnaryInfC{$
%      \Gamma^{\polcon}
%      \vdash
%      \muconabs{x^{\polprd}}{\mathcal{T}^{\polprd}}{c}
%      \con
%      \mathcal{T}^{\polprd}
%    $}
%  \end{prooftree}
%\end{minipage}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%  \AxiomC{$
%    \mathcal{C}^{\polcon}\Gamma^{\polcon}
%    \in
%    \textsc{Ctor}^{\polcon}(\mathcal{T}^{\polcon})
%  $}
%  \RightLabel{\textsc{R-$\polprd$-$\mu$}}
%  \UnaryInfC{$
%    \left(
%      \muprdabs{x^{\polcon}}{\mathcal{T}^{\polcon}}{c}
%      \mkCmd
%      \mathcal{C}^{\polcon}\overline{v^{\polcon}}
%    \right)
%    \reducesto_{\cmd}
%    c[\mathcal{C}^{\polcon}\overline{v^{\polcon}} / x^{\polcon}]
%  $}
%\end{prooftree}
%\vspace*{0.3cm}
%
%\begin{prooftree}
%  \AxiomC{$
%    \mathcal{C}^{\polprd}\Gamma^{\polprd}
%    \in
%    \textsc{Ctor}^{\polprd}(\mathcal{T}^{\polprd})
%  $}
%  \RightLabel{\textsc{R-$\polcon$-$\mu$}}
%  \UnaryInfC{$
%    \left(
%      \mathcal{C}^{\polprd}\overline{v^{\polprd}}
%      \mkCmd
%      \muconabs{x^{\polprd}}{\mathcal{T}^{\polprd}}{c}
%    \right)
%    \reducesto_{\cmd}
%    c[\mathcal{C}^{\polprd}\overline{v^{\polprd}} / x^{\polprd}]
%  $}
%\end{prooftree}
%
%Adding the remaining $\mu$-abstractions is more involved ...
%
%\subsection{Soundness}
%
%\begin{theorem}[$\pol$-Term-Preservation]
%  If $\vdash s^{\pol} \prdcon T$, and $s^{\pol} \reducesto_{\pol} t^{\pol}$, then $\vdash t^{\pol} \prdcon T$.
%\end{theorem}
%
%\begin{theorem}[$\pol$-Term-Progress]
%  If $\vdash s^{\pol} \prdcon T$, then either $s^{\pol}$ is a $\pol$-value, or otherwise $s^{\pol} \reducesto_{\pol} t^{\pol}$ for some $t^{\pol}$.
%\end{theorem}
%
%\begin{theorem}[Command-Preservation]
%  If $\vdash c_{1} \dashv$, and $c_{1} \reducesto_{\cmd} c_{2}$, then $\vdash c_{2} \dashv$.
%\end{theorem}
%
%\begin{theorem}[Command-Progress]
%  If $\vdash c_{1} \dashv$, then either $c_{1} = \Done$ or there exists a command $c_{2}$ such that $c_{1} \reducesto_{\cmd} c_{2}$.
%\end{theorem}
